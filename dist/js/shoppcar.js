"use strict";$(function(){$("#topCats").hover(function(){$(".catitmlst").css("display","block")},function(){$(".catitmlst").css("display","none")});var a=cookie.get("username");function t(t){$(".addrbox .tt li").removeClass("addractive"),$(t).addClass("addractive"),$(".addrbox .abox").css("display","none")}function o(t,s){$.ajax({type:"get",url:"../api/main.php",data:{a:"delete",sqlname:"cart",username:t,gid:s},success:function(t){checkSql()},async:!0})}function s(t){var s=1*t.parent().prev().children(".newprice").text(),o=1*t.parent().find("input").val(),a=s*o;t.parent().next().children(".goodsitem .sum").html(""+a.toFixed(2));var n=t.parents(".goodsitem").attr("data-id");i(),c(n,"number",o),c(n,"sum",a)}function c(t,s,o){$.ajax({type:"get",url:"../api/main.php",data:{a:"reSetCart",sqlname:"cart",username:a,gid:t,changeName:s,changeNumber:o},async:!0})}$(".iptw").on("click",function(){$(".addrbox").toggle()}),$(".addrbox").on("click",".addrclose",function(){$(".addrbox").css("display","none")}),$(".addrbox .tt").on("click","#shengfeng",function(){t($(this)),$("#sfbox").css("display","block")}),$(".addrbox .tt").on("click","#city",function(){t($(this)),$("#citybox").css("display","block")}),$(".addrbox .tt").on("click","#xianqu",function(){t($(this)),$("#xianqubox").css("display","block")}),$(".my-goods").on("mousemove",".ask",function(){$(this).parent().next().css("display","block")}),$(".my-goods").on("mouseout",".ask",function(){$(".my-goods").on("mousemove",".ans",function(){$(this).css("display","block")}),$(".my-goods").on("mouseout",".ans",function(){$(this).css("display","none")})}),$(".cartmain").on("click",".u-ck",function(){1==$(this).prop("checked")?$(this).addClass("u-ck2"):$(this).removeClass("u-ck2")}),$.ajax({type:"get",url:"../api/main.php",data:{a:"getCart",sqlname:"cart",username:a},success:function(t){var s=JSON.parse(t).data.list;console.log(s);var o=s.map(function(t){return'<li class="goodsitem" data-id="'+t.gid+'">\n\t\t\t\t\t\t\t\t\t<div class="g-col g-col1">\n\t\t\t\t\t\t\t\t\t\t<input type="checkbox" class="u-ck goodschoose"/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="g-col g-col2">\n\t\t\t\t\t\t\t\t\t\t<a href="goods.html?gid='+t.gid+'" class="imgwrap">\n\t\t\t\t\t\t\t\t\t\t\t<img src="../'+t.littleimg+'" alt="" />\n\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t<div class="txtwrap">\n\t\t\t\t\t\t\t\t\t\t\t<h3 class="goodtil">\n\t\t\t\t\t\t\t\t\t\t\t\t<a href="goods.html?gid='+t.gid+'" title="'+t.goodname+'">\n\t\t\t\t\t\t\t\t\t\t\t\t\t'+t.goodname+'\n\t\t\t\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t\t\t\t\t<p class="returninfo" title="支持7天无忧退货">\n\t\t\t\t\t\t\t\t\t\t\t\t<img src="../img/txtwrap-7tian.png" alt="" />\n\t\t\t\t\t\t\t\t\t\t\t\t<span>支持7天无忧退货</span>\n\t\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="g-col g-col3">\n\t\t\t\t\t\t\t\t\t\t<del class="oldprice">'+t.oldprice+'</del>\n\t\t\t\t\t\t\t\t\t\t<span class="newprice">'+t.newprice+'</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="g-col g-col4">\n\t\t\t\t\t\t\t\t\t\t<span class="minus algorithm">-</span>\n\t\t\t\t\t\t\t\t\t\t<input type="text" class="ipt" value="'+t.number+'" min="1" />\n\t\t\t\t\t\t\t\t\t\t<span class="plus algorithm">+</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="g-col g-col5">\n\t\t\t\t\t\t\t\t\t\t<span class="sum">'+t.sum+'</span>\n\t\t\t\t\t\t\t\t\t\t<p class="taxrow">\n\t\t\t\t\t\t\t\t\t\t\t<i class="ask">?</i>\n\t\t\t\t\t\t\t\t\t\t\t<span class="u-taxval">预计税费￥<span class="shuifei">'+t.shuifei+'</span> </span>\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t<div class="ans">\n\t\t\t\t\t\t\t\t\t\t\t<span class="b-shanjiao"></span>\n\t\t\t\t\t\t\t\t\t\t\t<span class="s-shanjiao"></span>\n\t\t\t\t\t\t\t\t\t\t\t<a href="">税费 = 购买单价 * 件数 * 税负率</a>\n\t\t\t\t\t\t\t\t\t\t\t<p>实际结算税费请以提交订单时的税费明细为准</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="g-col g-col6">\n\t\t\t\t\t\t\t\t\t\t<span class="u-opt del">删除</span>\n\t\t\t\t\t\t\t\t\t\t<span class="u-opt tomyCollection">移入我的收藏</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</li>'}).join("");$(".my-goods").html(o)},async:!0}),$(".my-goods").on("click",".plus",function(){var t=$(this).prev().val();t++,$(this).prev().val(t),s($(this))}),$(".my-goods").on("click",".minus",function(){var t=$(this).next().val();--t<=0&&(t=1),$(this).next().val(t),s($(this))}),$(".my-goods").on("input","li .ipt",function(){console.log($(this).val());var t=0<$(this).val()?$(this).val():1;$(this).val(t),s($(this))}),$(".my-goods").on("click",".goodschoose",function(){i()}),$("#selectAll").on("click",function(){$(this).prop("checked")?$(".goodschoose").prop("checked","checked").addClass("u-ck2"):($(".goodschoose").prop("checked","").removeClass("u-ck2"),$("#selectall").prop("checked","").removeClass("u-ck2")),i()}),$("#selectall").on("click",function(){$(this).prop("checked")?$(".goodschoose").prop("checked","checked").addClass("u-ck2"):($(".goodschoose").prop("checked","").removeClass("u-ck2"),$("#selectAll").prop("checked","").removeClass("u-ck2")),i()}),$(".my-goods").on("click",".del",function(){$(this).parents(".goodsitem").remove();var t=$(this).parents(".goodsitem").attr("data-id");o(a,t),i()}),$(".opt").on("click",function(){for(var t=e.length-1;0<=t;t--){var s=$(".goodschoose").eq(e[t]).parents(".goodsitem").attr("data-id");$(".goodschoose").eq(e[t]).parents(".goodsitem").remove(),o(a,s)}i()});var e=[];function i(){e=[];for(var t=$(".g-col1 input").length,s=0;s<t;s++)$(".g-col1 input").eq(s).prop("checked")&&e.push(s);e.length?$(".gobuy").removeClass("z-disable"):$(".gobuy").addClass("z-disable"),e.length==t&&($("#selectAll").prop("checked","checked").addClass("u-ck2"),$("#selectall").prop("checked","checked").addClass("u-ck2"));for(var o=0,a=0,n=0,c=0;c<e.length;c++)a+=1*$(".goodsitem .ipt").eq(e[c]).val(),o+=1*$(".goodsitem .sum").eq(e[c]).text(),console.log($(".goodsitem .sum").eq(e[c]).text()),n+=1*$(".shuifei").eq(e[c]).text();$(".allgoods .goodsnum").html(a),$(".cartinfo .sf").html("￥"+n.toFixed(2)),$(".totalbox .allmoney .sf").html("商品税费（不含运费税）:￥ "+n.toFixed(2)),$(".allgoods .goodssum").html("￥"+o.toFixed(2)),$(".cartinfo .totalnum").html("￥"+o.toFixed(2)),$(".totalbox .allmoney .sum").html("商品应付总计：￥  "+o.toFixed(2))}});